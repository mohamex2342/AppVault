<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق المحادثة - الرئيسية</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Emoji Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.18.1/picker.css">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <i class="fas fa-comments fa-3x"></i>
            <p>جاري التحميل...</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="chat-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">
                        <img id="userAvatar" src="" alt="User" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="avatar-placeholder"><i class="fas fa-user"></i></div>
                    </div>
                    <div class="user-details">
                        <h3 id="userName">المستخدم</h3>
                        <p class="user-status">متصل</p>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <button class="icon-btn" id="newChatBtn" title="محادثة جديدة">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="icon-btn" id="newGroupBtn" title="مجموعة جديدة">
                        <i class="fas fa-users"></i>
                    </button>
                    <button class="icon-btn" id="profileBtn" title="الملف الشخصي">
                        <i class="fas fa-user-cog"></i>
                    </button>
                    <button class="icon-btn" id="logoutBtn" title="تسجيل الخروج">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="ابحث في المحادثات...">
            </div>

            <!-- Conversations List -->
            <div class="conversations-list" id="conversationsList">
                <!-- سيتم ملء القائمة ديناميكياً -->
            </div>
        </aside>

        <!-- Chat Area -->
        <main class="chat-area" id="chatArea">
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <i class="fas fa-comments"></i>
                <h2>مرحباً بك في تطبيق المحادثة</h2>
                <p>اختر محادثة من القائمة أو ابدأ محادثة جديدة</p>
                <button class="btn btn-primary" id="startChatBtn">
                    <i class="fas fa-plus"></i> بدء محادثة جديدة
                </button>
            </div>

            <!-- Chat Header -->
            <div class="chat-header" id="chatHeader" style="display: none;">
                <div class="chat-info">
                    <button class="icon-btn mobile-back" id="mobileBackBtn">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <div class="chat-avatar">
                        <img id="chatAvatar" src="" alt="Chat" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="avatar-placeholder"><i class="fas fa-user"></i></div>
                        <span class="online-indicator" id="onlineIndicator"></span>
                    </div>
                    <div class="chat-details">
                        <h3 id="chatName">اسم المحادثة</h3>
                        <p id="chatStatus">آخر ظهور...</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="icon-btn" id="searchMessagesBtn" title="بحث في الرسائل">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="icon-btn" id="chatInfoBtn" title="معلومات المحادثة">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer" style="display: none;">
                <!-- سيتم ملء الرسائل ديناميكياً -->
            </div>

            <!-- Message Input -->
            <div class="message-input-container" id="messageInputContainer" style="display: none;">
                <button class="icon-btn" id="attachBtn" title="إرفاق ملف">
                    <i class="fas fa-paperclip"></i>
                </button>
                <button class="icon-btn" id="emojiBtn" title="إضافة إيموجي">
                    <i class="fas fa-smile"></i>
                </button>
                <div class="input-wrapper">
                    <textarea id="messageInput" placeholder="اكتب رسالتك هنا..." rows="1"></textarea>
                </div>
                <button class="send-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- New Chat Modal -->
    <div class="modal" id="newChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> محادثة جديدة</h2>
                <button class="close-modal" data-modal="newChatModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchUsers" placeholder="ابحث عن مستخدم...">
                </div>
                <div class="users-list" id="usersList">
                    <!-- سيتم ملء القائمة ديناميكياً -->
                </div>
            </div>
        </div>
    </div>

    <!-- New Group Modal -->
    <div class="modal" id="newGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-users"></i> مجموعة جديدة</h2>
                <button class="close-modal" data-modal="newGroupModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>اسم المجموعة</label>
                    <input type="text" id="groupName" class="form-control" placeholder="أدخل اسم المجموعة">
                </div>
                <div class="form-group">
                    <label>صورة المجموعة (اختياري)</label>
                    <input type="file" id="groupAvatar" accept="image/*">
                </div>
                <div class="form-group">
                    <label>إضافة أعضاء</label>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchGroupMembers" placeholder="ابحث عن مستخدم...">
                    </div>
                    <div class="users-list" id="groupMembersList">
                        <!-- سيتم ملء القائمة ديناميكياً -->
                    </div>
                </div>
                <button class="btn btn-primary" id="createGroupBtn">
                    <i class="fas fa-check"></i> إنشاء المجموعة
                </button>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div class="modal" id="filePreviewModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2><i class="fas fa-paperclip"></i> معاينة الملف</h2>
                <button class="close-modal" data-modal="filePreviewModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="filePreview" class="file-preview-area"></div>
                <div class="form-group">
                    <textarea id="fileCaption" class="form-control" rows="3" placeholder="أضف تعليق (اختياري)..."></textarea>
                </div>
                <button class="btn btn-primary" id="sendFileBtn">
                    <i class="fas fa-paper-plane"></i> إرسال
                </button>
            </div>
        </div>
    </div>

    <!-- Emoji Picker Container -->
    <div id="emojiPickerContainer" style="display: none; position: absolute;"></div>

    <!-- File Input (Hidden) -->
    <input type="file" id="fileInput" style="display: none;" multiple accept="image/*,video/*,audio/*,application/*">

    <!-- Audio Notification -->
    <audio id="notificationSound" preload="auto">
        <source src="https://cdn.jsdelivr.net/gh/muhammederdem/mini-player@master/notification.mp3" type="audio/mpeg">
    </audio>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script src="js/auth.js"></script>

<script src="js/chat.js"></script>
<script src="js/media.js"></script> 
<script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.18.1/index.js" type="module"></script>
</body>
</html>
